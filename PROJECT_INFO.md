# 项目信息

## 项目名称
日志到Excel匹配工具 (Log to Excel Matcher)

## 版本
v4.0.0 (工程化版本)

## 描述
一个将结构化日志文件自动填充到Excel模板中的Python工具。

## 项目结构

```
log_matcher_project/
├── README.md              # 项目说明
├── QUICKSTART.md          # 快速开始指南
├── VERSION                # 版本号
├── requirements.txt       # Python依赖
├── main.py               # 主程序入口
│
├── config/               # 配置模块
│   ├── __init__.py
│   └── default_config.py # 所有配置项
│
├── src/                  # 源代码模块
│   ├── __init__.py
│   ├── log_parser.py     # 日志解析 (143行)
│   ├── excel_processor.py # Excel处理 (550行)
│   ├── workflow.py       # 业务流程 (620行)
│   └── utils.py          # 工具函数 (45行)
│
├── examples/             # 示例文件
│   ├── templates/        # Excel模板
│   ├── logs/            # 日志文件
│   └── outputs/         # 输出结果
│
└── tests/               # 测试文件

总代码行数: ~1400行
```

## 核心模块说明

### 1. config/default_config.py
集中管理所有配置项：
- 关键字映射 (KEYWORD_MAPPING)
- 顶格表格配置
- 特殊前缀配置
- 字段名映射
- 自动文件名配置

### 2. src/log_parser.py
日志解析模块：
- LogParser类：解析结构化日志
- 提取配置块和字段值
- 支持字段名映射
- 支持TopConfig分组

### 3. src/excel_processor.py
Excel处理模块：
- ExcelProcessor类：Excel文件操作
- 智能字段匹配（A列/B列）
- 合并单元格处理
- 子表复制和删除

### 4. src/workflow.py
业务流程模块：
- process_log_to_excel：主处理函数
- process_single_sheet：单工作表处理
- process_multi_sheets：多工作表处理
- generate_auto_filename：自动文件名生成

### 5. src/utils.py
工具函数模块：
- extract_value：提取括号内容
- map_field_name：字段名映射
- get_target_column：列号转换

## 主要特性

1. **顶格表格处理**
   - 自动识别顶格配置块
   - 支持A列或B列匹配
   - 特殊前缀自动切换到B列

2. **子表处理**
   - 按日志顺序生成
   - 自动复制和删除
   - 支持正则匹配

3. **多TopConfig支持**
   - 自动检测多个TopConfig
   - 每个TopConfig独立工作表
   - 智能命名

4. **智能匹配**
   - 精确匹配/部分匹配
   - 合并单元格支持
   - 字段名映射

5. **自动文件名**
   - 基于字段值生成
   - 值映射支持
   - 可配置字段列表

## 依赖

- Python >= 3.6
- openpyxl >= 3.0.0

## 使用方法

```bash
# 基本使用
python main.py template.xlsx log.txt

# 指定输出
python main.py template.xlsx log.txt --output result.xlsx

# 指定工作表
python main.py template.xlsx log.txt --sheet 配置表
```

## 配置示例

```python
# 添加新的子表类型
KEYWORD_MAPPING = {
    'NewType': r'NewPattern\d+',
}

# 修改顶表关键字
TOP_TABLE_LOG_KEYWORD = 'MyTopTable'

# 自定义文件名
FILENAME_FIELDS = ['field1', 'field2']
FILENAME_VALUE_MAPPING = {
    'field1': {'val1': 'name1'},
}
```

## 开发指南

### 添加新功能
1. 在 `config/default_config.py` 添加配置
2. 在对应模块实现功能
3. 在 `workflow.py` 集成流程

### 修改匹配逻辑
编辑 `src/excel_processor.py` 中的:
- match_and_fill_top_table()
- match_and_fill_sub_table()

### 修改解析逻辑
编辑 `src/log_parser.py` 中的:
- parse()
- group_by_top_config()

## 测试

```bash
# 运行示例
python main.py examples/templates/template_a_column.xlsx examples/logs/sample_log_opsch.txt

# 查看输出
ls -la examples/outputs/
```

## 版本历史

### v4.0.0 (2024-02)
- ✅ 工程化重构
- ✅ 模块化设计
- ✅ 配置分离
- ✅ 完整文档

### v3.8 (之前版本)
- 多TopConfig支持
- 特殊前缀处理
- 按日志顺序生成子表
- 自动文件名

## 许可证

MIT License

## 作者

Generated by Claude (Anthropic)
