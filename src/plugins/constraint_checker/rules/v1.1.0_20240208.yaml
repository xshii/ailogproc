# 配置约束规则 v1.1.0
# 创建日期: 2024-02-08
# 描述: 增强版本 - 新增三组级联约束

version: "1.1.0"
date: "2024-02-08"
description: "增强版本约束规则"
author: "Team"
changelog:
  - "debugLevel 允许级别扩展到 0-3"
  - "powerMode 新增 high 模式"
  - "新增三组配置ID递增检查"
  - "新增级联功率控制约束"

# 单组约束
single_constraints:
  - name: "系统模式1的配置约束"
    when:
      systemMode: "1"
    only_allow:
      debugLevel: ["0", "1", "2", "3"]  # 新增允许级别3
      powerMode: ["low", "medium", "high"]  # 新增 high
    forbid:
      dangerousFlag: ["1", "true"]

  - name: "调试模式约束"
    when:
      debugLevel: "3"
      systemMode: "2"  # 多条件
    forbid:
      productionMode: ["1", "enabled"]

# 多组约束
multi_constraints:
  - name: "连续两组systemMode一致性"
    group_count: 2
    rules:
      - type: "same_value"
        field: "systemMode"

  - name: "三组配置ID递增检查"
    description: "连续三组配置的 configId 必须递增"
    group_count: 3
    rules:
      - type: "sequence"
        field: "configId"
        order: "increasing"

  - name: "级联功率控制"
    description: "高功率模式不能直接切换到低功率"
    group_count: 3
    rules:
      - type: "conditional"
        when_group: 0
        when_field: "powerMode"
        when_value: "high"
        then_group: 1
        then_field: "powerMode"
        forbid: ["low"]

      - type: "conditional"
        when_group: 1
        when_field: "powerMode"
        when_value: "high"
        then_group: 2
        then_field: "powerMode"
        forbid: ["low"]
